/******************************************************************************
Copyright 2019 The Regents of the University of California.
All Rights Reserved.

Permission to copy, modify and distribute any part of this Software for
educational, research and non-profit purposes, without fee, and without
a written agreement is hereby granted, provided that the above copyright
notice, this paragraph and the following three paragraphs appear in all
copies.

Those desiring to incorporate this Software into commercial products or
use for commercial purposes should contact the:
Office of Innovation & Commercialization
University of California, San Diego
9500 Gilman Drive, Mail Code 0910
La Jolla, CA 92093-0910
Ph: (858) 534-5815
FAX: (858) 534-7345
E-MAIL: invent@ucsd.edu

IN NO EVENT SHALL THE UNIVERSITY OF CALIFORNIA BE LIABLE TO ANY PARTY FOR
DIRECT, INDIRECT, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, INCLUDING
LOST PROFITS, ARISING OUT OF THE USE OF THIS SOFTWARE, EVEN IF THE UNIVERSITY
OF CALIFORNIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

THE SOFTWARE PROVIDED HEREIN IS ON AN "AS IS" BASIS, AND THE UNIVERSITY OF
CALIFORNIA HAS NO OBLIGATION TO PROVIDE MAINTENANCE, SUPPORT, UPDATES,
ENHANCEMENTS, OR MODIFICATIONS. THE UNIVERSITY OF CALIFORNIA MAKES NO
REPRESENTATIONS AND EXTENDS NO WARRANTIES OF ANY KIND, EITHER IMPLIED OR
EXPRESS, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE, OR THAT THE USE OF THE
SOFTWARE WILL NOT INFRINGE ANY PATENT, TRADEMARK OR OTHER RIGHTS.
******************************************************************************/

#include "x2b_A1B2Z2_C1D4_deg3_exp0_v1x.h"

////////////////////////////////////////////////////////////////////////////////

namespace {

//----------------------------------------------------------------------------//

struct variable {
    double v_exp0(const double& r0, const double& k, const double* p1, const double* p2);

    double v_coul0(const double& r0, const double& k, const double* p1, const double* p2);

    void grads(const double& gg, double* grd1, double* grd2, const double* p1, const double* p2);

    double g[3];  // diff(value, p1 - p2)
};

//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //

double variable::v_exp0(const double& r0, const double& k, const double* p1, const double* p2) {
    g[0] = p1[0] - p2[0];
    g[1] = p1[1] - p2[1];
    g[2] = p1[2] - p2[2];

    const double r = std::sqrt(g[0] * g[0] + g[1] * g[1] + g[2] * g[2]);

    const double exp1 = std::exp(k * (r0 - r));
    const double gg = -k * exp1 / r;

    g[0] *= gg;
    g[1] *= gg;
    g[2] *= gg;

    return exp1;
}

//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //

double variable::v_coul0(const double& r0, const double& k, const double* p1, const double* p2) {
    g[0] = p1[0] - p2[0];
    g[1] = p1[1] - p2[1];
    g[2] = p1[2] - p2[2];

    const double rsq = g[0] * g[0] + g[1] * g[1] + g[2] * g[2];
    const double r = std::sqrt(rsq);

    const double exp1 = std::exp(k * (r0 - r));
    const double rinv = 1.0 / r;
    const double val = exp1 * rinv;

    const double gg = -(k + rinv) * val * rinv;

    g[0] *= gg;
    g[1] *= gg;
    g[2] *= gg;

    return val;
}

//----------------------------------------------------------------------------//

void variable::grads(const double& gg, double* grd1, double* grd2, const double* p1, const double* p2) {
    for (size_t i = 0; i < 3; i++) {
        double d = gg * g[i];
        grd1[i] += d;
        grd2[i] -= d;
    }
}

//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //

struct monomer {
    double oh1[3];
    double oh2[3];

    void setup(const double* ohh, const double& in_plane_g, const double& out_of_plane_g, double x1[3], double x2[3]);

    void grads(const double* g1, const double* g2, const double& in_plane_g, const double& out_of_plane_g,
               double* grd) const;
};

//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //

void monomer::setup(const double* ohh, const double& in_plane_g, const double& out_of_plane_g, double* x1, double* x2) {
    for (int i = 0; i < 3; ++i) {
        oh1[i] = ohh[i + 3] - ohh[i];
        oh2[i] = ohh[i + 6] - ohh[i];
    }

    const double v[3] = {oh1[1] * oh2[2] - oh1[2] * oh2[1], oh1[2] * oh2[0] - oh1[0] * oh2[2],
                         oh1[0] * oh2[1] - oh1[1] * oh2[0]};

    for (int i = 0; i < 3; ++i) {
        const double in_plane = ohh[i] + 0.5 * in_plane_g * (oh1[i] + oh2[i]);
        const double out_of_plane = out_of_plane_g * v[i];

        x1[i] = in_plane + out_of_plane;
        x2[i] = in_plane - out_of_plane;
    }
}

//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //

void monomer::grads(const double* g1, const double* g2, const double& in_plane_g, const double& out_of_plane_g,
                    double* grd) const {
    const double gm[3] = {g1[0] - g2[0], g1[1] - g2[1], g1[2] - g2[2]};

    const double t1[3] = {oh2[1] * gm[2] - oh2[2] * gm[1], oh2[2] * gm[0] - oh2[0] * gm[2],
                          oh2[0] * gm[1] - oh2[1] * gm[0]};

    const double t2[3] = {oh1[1] * gm[2] - oh1[2] * gm[1], oh1[2] * gm[0] - oh1[0] * gm[2],
                          oh1[0] * gm[1] - oh1[1] * gm[0]};

    for (int i = 0; i < 3; ++i) {
        const double gsum = g1[i] + g2[i];
        const double in_plane = 0.5 * in_plane_g * gsum;

        const double gh1 = in_plane + out_of_plane_g * t1[i];
        const double gh2 = in_plane - out_of_plane_g * t2[i];

        grd[i + 0] += gsum - (gh1 + gh2);  // O
        grd[i + 3] += gh1;                 // H1
        grd[i + 6] += gh2;                 // H2
    }
}

//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //
}  // namespace

////////////////////////////////////////////////////////////////////////////////

namespace x2b_A1B2Z2_C1D4_deg3_exp0 {

//----------------------------------------------------------------------------//

x2b_A1B2Z2_C1D4_v1x::x2b_A1B2Z2_C1D4_v1x(std::string mon1, std::string mon2) {
    // =====>> SECTION CONSTRUCTOR <<=====
    // =>> PASTE RIGHT BELOW THIS LINE <==

    if (mon1 == "h2o" && mon2 == "ch4_0p") {
        coefficients = std::vector<double>{-6.667897730232606e-01,  // 0
                                           5.596504399551975e+00,   // 1
                                           -1.168984543918323e-01,  // 2
                                           1.424926008147416e-01,   // 3
                                           1.078296412304094e+02,   // 4
                                           -1.416404525678908e+00,  // 5
                                           -4.588375499346509e+00,  // 6
                                           2.682949173362121e+00,   // 7
                                           2.354346656968209e-02,   // 8
                                           -4.825278676507744e-02,  // 9
                                           3.022822250472468e+00,   // 10
                                           3.190343275461254e+00,   // 11
                                           -7.938895608141194e-01,  // 12
                                           -5.150673181039061e+00,  // 13
                                           6.194834890653090e-01,   // 14
                                           -1.218155942813632e+00,  // 15
                                           -1.488412032883762e-01,  // 16
                                           -5.959946011813311e-01,  // 17
                                           -1.873608756849549e-04,  // 18
                                           -6.149031475153143e-04,  // 19
                                           4.839740967126692e-05,   // 20
                                           2.800193328731844e+01,   // 21
                                           -1.199723782000838e+00,  // 22
                                           2.158341487721773e-02,   // 23
                                           1.943372891348710e-01,   // 24
                                           4.025595704935679e-02,   // 25
                                           -1.479974814814933e+00,  // 26
                                           -3.002056387011198e+01,  // 27
                                           -4.000015930234856e-05,  // 28
                                           -3.372194343778273e-03,  // 29
                                           -1.780618589489745e-06,  // 30
                                           -6.393824340514637e-01,  // 31
                                           -1.793515328351654e-01,  // 32
                                           -1.015580524720145e-02,  // 33
                                           -3.259750482162428e-02,  // 34
                                           1.731005365403339e+01,   // 35
                                           8.390179146060003e-01,   // 36
                                           1.866004969730512e-02,   // 37
                                           -2.584077286946449e+01,  // 38
                                           -1.084223059242524e+02,  // 39
                                           -7.035602171448033e-02,  // 40
                                           5.619441457186135e-04,   // 41
                                           6.950170205655136e-03,   // 42
                                           -5.793222386743941e-04,  // 43
                                           2.831413821892537e-02,   // 44
                                           1.229543597426785e-01,   // 45
                                           -2.130224712164064e-03,  // 46
                                           -2.229589254068883e-03,  // 47
                                           -3.401837000858845e-03,  // 48
                                           4.704924195963721e-02,   // 49
                                           -5.325342835087452e-02,  // 50
                                           2.777584045740241e+01,   // 51
                                           -4.835566190121506e-02,  // 52
                                           6.420814311643291e-01,   // 53
                                           3.939239978758203e+01,   // 54
                                           3.884042160394750e+01,   // 55
                                           3.879188238869244e+01,   // 56
                                           6.898907585125643e+01,   // 57
                                           -1.693241581752751e+02,  // 58
                                           7.813944503638978e+00,   // 59
                                           -2.079023434688494e+01,  // 60
                                           1.320259647829929e-02,   // 61
                                           -1.837937841342711e-05,  // 62
                                           3.781782331968474e+01,   // 63
                                           -2.059209054842793e+00,  // 64
                                           -7.228251275007989e-02,  // 65
                                           -3.899866650977641e-03,  // 66
                                           -2.650042990428283e+02,  // 67
                                           5.144672891171442e-05,   // 68
                                           -6.485206322121751e+00,  // 69
                                           8.413219842250658e-02,   // 70
                                           2.844055326210733e-04,   // 71
                                           4.596427287359172e+01,   // 72
                                           4.704670513537583e+00,   // 73
                                           1.437779058956111e-04,   // 74
                                           -1.180636742412670e-04,  // 75
                                           3.938987419986779e-02,   // 76
                                           1.808072719584070e-05,   // 77
                                           -7.117518084415089e+00,  // 78
                                           -5.731937095332376e-05,  // 79
                                           -1.571596621560526e-02,  // 80
                                           -6.430228099932955e-05,  // 81
                                           8.570025439847245e-07,   // 82
                                           -5.797290783003637e-07,  // 83
                                           -6.028271921180661e+01,  // 84
                                           6.964263913813530e-08,   // 85
                                           9.222689079557538e-01,   // 86
                                           -1.745109234099559e+01,  // 87
                                           2.274661223885016e-01,   // 88
                                           -5.492151211044077e-08,  // 89
                                           -1.006804130308804e-08,  // 90
                                           -6.743982784805516e-01,  // 91
                                           -5.117232802897095e-03,  // 92
                                           8.942406215541726e+01,   // 93
                                           -2.661097653676259e-04,  // 94
                                           -1.911728046299776e-03,  // 95
                                           -1.227307033237032e-03,  // 96
                                           -9.240216738072281e-02,  // 97
                                           -6.577041593601417e-03,  // 98
                                           -2.160608886537773e+00,  // 99
                                           8.401225137449343e+01,   // 100
                                           -4.427185003350060e-01,  // 101
                                           4.092848791097888e-05,   // 102
                                           1.106874863555944e-01,   // 103
                                           1.296466611707251e-06,   // 104
                                           -4.943474118664828e-04,  // 105
                                           -4.850893490067690e-01,  // 106
                                           -6.326703226604104e-02,  // 107
                                           -1.625070069362679e-05,  // 108
                                           -3.864167873097532e-02,  // 109
                                           8.300066642926793e-03,   // 110
                                           -2.129032063372631e-05,  // 111
                                           7.621640205569844e-08,   // 112
                                           4.654640235004752e-05,   // 113
                                           -5.267674011405474e-02,  // 114
                                           7.370636113105952e+00,   // 115
                                           2.010239939328634e-01,   // 116
                                           4.803430609781886e-03,   // 117
                                           4.289802156354741e-01,   // 118
                                           -2.762330378026373e-03,  // 119
                                           3.674449634610194e-04,   // 120
                                           -6.343350865699257e-05,  // 121
                                           -1.656220958334599e-04,  // 122
                                           4.956372168093410e-03,   // 123
                                           -7.615316833666788e-05,  // 124
                                           -4.268010643904305e-02,  // 125
                                           6.462559571817332e-05,   // 126
                                           -1.671154089068236e-02,  // 127
                                           7.626165235389046e-04,   // 128
                                           1.357953750699743e+01,   // 129
                                           2.090416203662259e+00,   // 130
                                           8.053793443509317e-01,   // 131
                                           3.010004178795943e-02,   // 132
                                           1.346542481640652e+00,   // 133
                                           2.344237645085255e-04,   // 134
                                           -3.695515383146058e-05,  // 135
                                           6.534354334893480e-05,   // 136
                                           -4.057607985776134e-02,  // 137
                                           -1.900720974500376e-05,  // 138
                                           1.485308873583931e-03,   // 139
                                           -6.726813237575493e-03,  // 140
                                           1.743817905146247e+01,   // 141
                                           -4.775065064622651e-01,  // 142
                                           1.324061962131606e-03,   // 143
                                           2.101235773698041e-03,   // 144
                                           -2.425534485725789e-04,  // 145
                                           5.702254933019335e+00,   // 146
                                           -3.610587530577202e+01,  // 147
                                           -8.481643112488881e-08,  // 148
                                           1.046038367705384e-05,   // 149
                                           1.172993715345265e-03,   // 150
                                           -2.465142680147702e-03,  // 151
                                           1.551399380225831e-02,   // 152
                                           -2.366450529708979e-01,  // 153
                                           -7.182723835775081e-08,  // 154
                                           -3.639371803975445e-06,  // 155
                                           -6.039412508167536e-07,  // 156
                                           -1.983733811733661e+00,  // 157
                                           2.660234988052820e+00,   // 158
                                           8.700631594305379e-02,   // 159
                                           1.148241308653293e-01,   // 160
                                           -1.198102696078090e+00,  // 161
                                           -5.349589886213443e-02,  // 162
                                           -8.381619330845072e-05,  // 163
                                           6.920019463475095e-08,   // 164
                                           4.491553843868302e-02,   // 165
                                           1.676365613209165e+00,   // 166
                                           4.645914692339132e-04,   // 167
                                           6.355313714432094e-03,   // 168
                                           -7.189970366877352e-04,  // 169
                                           1.842161258224931e-01,   // 170
                                           4.162846092871490e-03,   // 171
                                           1.791516674666455e-05,   // 172
                                           -4.714609253487954e-01,  // 173
                                           -4.470128442864425e-02,  // 174
                                           -3.552727441562961e-02,  // 175
                                           2.397321464100021e+00,   // 176
                                           9.572044390309403e+00,   // 177
                                           3.701033484446181e-03,   // 178
                                           -2.193252021267218e+00,  // 179
                                           -6.522291921269434e-04,  // 180
                                           3.070309237091712e-01,   // 181
                                           -1.388797185778596e-03,  // 182
                                           2.998313698896919e-03,   // 183
                                           -3.618760666558178e+01,  // 184
                                           1.327462398289214e-03,   // 185
                                           -1.460157627935193e+00,  // 186
                                           -1.622820436715857e-01,  // 187
                                           1.618504321201674e-05,   // 188
                                           1.078141608643406e-02,   // 189
                                           2.892792187202217e+01,   // 190
                                           2.570837118236699e+01,   // 191
                                           -1.071320087095255e-05,  // 192
                                           -1.965656092064251e-01,  // 193
                                           -3.873126860914137e-03,  // 194
                                           -2.153572330238474e-01,  // 195
                                           -7.604351592627796e-03,  // 196
                                           1.453427913726125e+01,   // 197
                                           -1.687726604103576e-01,  // 198
                                           2.147283434092362e-04,   // 199
                                           3.119810694886059e-02,   // 200
                                           3.572904390474796e-03,   // 201
                                           -6.403410028385495e-04,  // 202
                                           2.269038046044835e-01,   // 203
                                           -8.290985884846206e-05,  // 204
                                           -1.970120045420160e+00,  // 205
                                           1.237084935990218e-02,   // 206
                                           -7.015915078770812e-07,  // 207
                                           -3.019493464829796e-02,  // 208
                                           6.309908025986296e-05,   // 209
                                           -4.593549196814633e+01,  // 210
                                           -7.469959088769289e-02,  // 211
                                           5.800931267876226e+00,   // 212
                                           6.285602878273358e-04,   // 213
                                           -8.940877729144111e-04,  // 214
                                           -1.709396290889524e-02,  // 215
                                           -1.312150565545709e-03,  // 216
                                           2.110816643503988e-01,   // 217
                                           -3.380456139888878e-01,  // 218
                                           6.427397496460580e-04,   // 219
                                           8.517199544062425e+00,   // 220
                                           2.101763783998778e+00,   // 221
                                           -1.062688924695234e-03,  // 222
                                           -4.390129632591365e-01,  // 223
                                           9.475460814811776e-01,   // 224
                                           -4.989642934004637e-02,  // 225
                                           1.058158276096006e-02,   // 226
                                           5.219146949128568e-01,   // 227
                                           -9.778542614498606e-03,  // 228
                                           -5.686567192791892e-03,  // 229
                                           -1.269556663188795e-05,  // 230
                                           -1.435279997551704e-03,  // 231
                                           -1.987121441249136e-01,  // 232
                                           1.512901523928536e-03,   // 233
                                           3.386296254026880e+01,   // 234
                                           2.339960642034571e-05,   // 235
                                           1.276549469150471e-03,   // 236
                                           2.118028416221963e-01,   // 237
                                           -1.130226538369448e-01,  // 238
                                           6.689333678103126e-03,   // 239
                                           -1.378550249020017e-03,  // 240
                                           5.814082842837780e-01,   // 241
                                           6.947574048349878e-02,   // 242
                                           8.912575605727561e+00,   // 243
                                           -1.228682218088273e-04,  // 244
                                           3.524677575308601e-03,   // 245
                                           3.955170256270761e-04,   // 246
                                           -8.123081988617178e-05,  // 247
                                           1.530394367610741e-01,   // 248
                                           -1.025530395194736e+00,  // 249
                                           5.498321574559364e+00,   // 250
                                           5.744791588208654e-04,   // 251
                                           2.455657006669415e-01,   // 252
                                           -5.446102394123301e-04,  // 253
                                           -5.228187524542225e+01,  // 254
                                           -3.275827024034168e-03,  // 255
                                           -6.151671010439582e-03,  // 256
                                           1.280072866812653e-06,   // 257
                                           -2.160994538726573e-06,  // 258
                                           -4.326815123869431e-02,  // 259
                                           -1.184796006948932e-01,  // 260
                                           1.840357851412423e-05,   // 261
                                           -1.682203657008836e-09,  // 262
                                           -2.243292526881525e-01,  // 263
                                           -2.904918420139840e-01,  // 264
                                           1.271036445236434e-05,   // 265
                                           -1.391649126553594e-04,  // 266
                                           -1.077221387758021e-01,  // 267
                                           1.608848106844682e-03,   // 268
                                           -6.860635314749773e-02,  // 269
                                           1.036282040133231e-01,   // 270
                                           3.361881985630391e-03,   // 271
                                           1.115166871525529e-03,   // 272
                                           -6.345680400400819e-04,  // 273
                                           4.928371721086618e-07,   // 274
                                           1.322084223343838e-05,   // 275
                                           -1.970309051292770e-04,  // 276
                                           4.400278408199257e-02,   // 277
                                           -1.342058534570657e-02,  // 278
                                           -6.280779059778056e-01,  // 279
                                           3.844700597253838e+00,   // 280
                                           -2.735066512229401e-03,  // 281
                                           2.959387892074466e-06,   // 282
                                           -5.112325614644928e-03,  // 283
                                           6.299016346851216e-02,   // 284
                                           7.338162633121899e+00,   // 285
                                           1.274570771876834e+00,   // 286
                                           -5.383772335301801e-03,  // 287
                                           3.072252789122617e-02,   // 288
                                           1.426960486052767e-05,   // 289
                                           -4.195721994726586e-02,  // 290
                                           3.329172453158659e-06,   // 291
                                           6.933843375844028e-05,   // 292
                                           6.452508619852394e-01,   // 293
                                           1.094116926673806e-01,   // 294
                                           -9.692639878936330e+00,  // 295
                                           -8.684321562868322e-02,  // 296
                                           5.336034083432924e-06,   // 297
                                           -4.330366154258305e-03,  // 298
                                           2.077639486621261e-05,   // 299
                                           -1.732017340049347e-03,  // 300
                                           -4.776882301743580e+01,  // 301
                                           -3.001435923530408e-03,  // 302
                                           5.114692799210425e-04,   // 303
                                           -3.190489729922480e-01,  // 304
                                           -7.107963785971618e-01,  // 305
                                           -1.832552680355216e-01,  // 306
                                           -5.372028567072065e-02,  // 307
                                           -2.761757173968652e-03,  // 308
                                           1.464184056778197e-03,   // 309
                                           -3.379397491787577e+01,  // 310
                                           1.206757107122948e-04,   // 311
                                           -8.314142867601198e-07,  // 312
                                           1.121656287366561e-03,   // 313
                                           -4.263500462105638e-07,  // 314
                                           -2.389379164284855e-03,  // 315
                                           -1.697090585232932e-03,  // 316
                                           -1.588637087366344e-03,  // 317
                                           -1.131633721134858e+01,  // 318
                                           7.344704281733002e+00,   // 319
                                           3.829217972800688e+01,   // 320
                                           -6.411630744039752e+00,  // 321
                                           -1.160980676949296e-01,  // 322
                                           -4.303980618269408e-01,  // 323
                                           5.804286614529081e-07,   // 324
                                           1.869115627526201e+01,   // 325
                                           -3.393192741591943e-06,  // 326
                                           -3.944639079957497e-04,  // 327
                                           -8.026453839128391e-01,  // 328
                                           1.109986474279142e-02,   // 329
                                           -8.492347765434617e-05,  // 330
                                           1.984447499608167e+01,   // 331
                                           -6.804556466359436e-04,  // 332
                                           8.815864385230744e-05,   // 333
                                           1.475150885244991e-03,   // 334
                                           3.379872754769897e-01,   // 335
                                           -6.225091874923395e-03,  // 336
                                           -1.577584914311476e-02,  // 337
                                           1.408043765507295e-10,   // 338
                                           -1.020288239874961e-02,  // 339
                                           -2.467139523989371e-07,  // 340
                                           4.577590888565567e-03,   // 341
                                           4.351103724607723e-03,   // 342
                                           -4.601354765941971e+00,  // 343
                                           9.010269735261988e-07,   // 344
                                           -1.070553217110984e-03,  // 345
                                           1.319727800717113e-03,   // 346
                                           1.486062767918943e+00,   // 347
                                           5.209591509250677e-03,   // 348
                                           -3.135073332275333e-03,  // 349
                                           1.181347747820425e-02,   // 350
                                           -6.005899841971467e-04,  // 351
                                           2.496633187746608e-03,   // 352
                                           -6.337247950893076e-06,  // 353
                                           -3.432727604882236e-03,  // 354
                                           -1.737814347857011e-04,  // 355
                                           -9.566082880542423e-06,  // 356
                                           8.036516226142322e-02,   // 357
                                           5.646190180936954e-05,   // 358
                                           -9.811517493329745e-06,  // 359
                                           -1.084537492696035e+00,  // 360
                                           2.962670706535463e-03,   // 361
                                           3.350917099480521e-05,   // 362
                                           1.155308555124044e+00,   // 363
                                           1.641243004430889e+00,   // 364
                                           1.498927648575983e-02,   // 365
                                           -2.681182674527224e-10,  // 366
                                           2.043930782617109e-01,   // 367
                                           -1.160721590814966e+01,  // 368
                                           -1.432560706681929e-08,  // 369
                                           -3.760398795322104e+00,  // 370
                                           -2.033970681744092e+00,  // 371
                                           -1.796192982670824e-05,  // 372
                                           -3.729889591409109e-04,  // 373
                                           -1.891219108526407e+00,  // 374
                                           6.304702899022759e-02,   // 375
                                           2.502196529540213e-02,   // 376
                                           -8.652134658187700e-02,  // 377
                                           1.738605346973560e-06,   // 378
                                           -1.049654193656759e+01,  // 379
                                           -2.312426653276462e-01,  // 380
                                           -1.148945603432723e+00,  // 381
                                           -1.704165523992871e-03,  // 382
                                           1.860585085933181e-02,   // 383
                                           3.493331074989940e-01,   // 384
                                           -2.167348360905898e-01,  // 385
                                           -9.010489806636199e-06,  // 386
                                           -5.483671798966093e-03,  // 387
                                           -1.931144556557901e-01,  // 388
                                           -5.453862941335837e-01,  // 389
                                           7.280933450552099e+01,   // 390
                                           5.172445028937525e+00,   // 391
                                           -1.046578845620322e-02,  // 392
                                           -7.674025290691450e-03,  // 393
                                           1.409742972614663e-02,   // 394
                                           1.208724103614768e-01,   // 395
                                           -1.143049564163091e-04,  // 396
                                           3.204578273490265e-02,   // 397
                                           -4.947734896387806e-06,  // 398
                                           4.534027888404652e-05,   // 399
                                           2.248738694897159e-03,   // 400
                                           8.390459663343446e-04,   // 401
                                           8.869755059163726e-03,   // 402
                                           -7.679697839687411e-03,  // 403
                                           -1.121778769441957e+02,  // 404
                                           -3.692900071523193e-05,  // 405
                                           -3.361977148877314e-05,  // 406
                                           -8.838140192625453e-02,  // 407
                                           3.819579650608451e-03,   // 408
                                           -2.462204161132169e-05,  // 409
                                           1.081173510985501e-06,   // 410
                                           7.130859772878220e-01,   // 411
                                           -8.817909924882658e-02,  // 412
                                           -2.939317596749372e-04,  // 413
                                           6.318781599333096e-03,   // 414
                                           3.400651570968559e+01,   // 415
                                           -4.881340122853978e-04,  // 416
                                           -1.775179184901351e-03,  // 417
                                           -9.278896439604822e-02,  // 418
                                           2.962696701434576e+00,   // 419
                                           6.482775747666708e-05,   // 420
                                           -6.494303409242407e-02,  // 421
                                           -8.011810341355210e+00,  // 422
                                           3.178054543271412e-04,   // 423
                                           -3.709459007351963e+01,  // 424
                                           6.327551331351539e-06,   // 425
                                           -3.444529472855406e+00,  // 426
                                           2.233850644298960e-06,   // 427
                                           -2.559857576753045e-01,  // 428
                                           2.141488035903475e-03,   // 429
                                           -1.332963796540022e+00,  // 430
                                           4.422161011324439e-02,   // 431
                                           5.416918291916327e-02,   // 432
                                           2.582574423598837e+00,   // 433
                                           7.718583380078237e-02,   // 434
                                           -4.358155438622317e-04,  // 435
                                           4.043295549093317e-07,   // 436
                                           -7.736905426197946e-05,  // 437
                                           -2.423479655112740e+01,  // 438
                                           1.228700964372700e+01,   // 439
                                           1.308975326577073e-05,   // 440
                                           -8.852616071921533e-01,  // 441
                                           5.220083656842801e-01,   // 442
                                           7.748310907008405e-03,   // 443
                                           4.131816256368492e-07,   // 444
                                           3.674236014168769e+00,   // 445
                                           3.900912420910752e-02,   // 446
                                           -6.004375392506594e-03,  // 447
                                           -3.855908896895744e-04,  // 448
                                           1.105542014418931e-05,   // 449
                                           4.649196573187858e-04,   // 450
                                           1.342148169177436e+00,   // 451
                                           -3.015738119056832e-03,  // 452
                                           -7.240354214376965e-02,  // 453
                                           -4.494573937842778e-05,  // 454
                                           -6.816960590705212e-01,  // 455
                                           5.776054288468700e-04,   // 456
                                           -1.772640339045807e+00,  // 457
                                           1.701844173159680e-05,   // 458
                                           -5.536856297421590e-05,  // 459
                                           9.011923253141287e-02,   // 460
                                           -3.701480731254526e-07,  // 461
                                           7.001808146901910e-07,   // 462
                                           -4.020477200095408e-02,  // 463
                                           1.298718439624117e+01,   // 464
                                           1.226234690270541e-01,   // 465
                                           -9.784203310702628e-05,  // 466
                                           1.244860866546270e-03,   // 467
                                           -8.580811921983538e-05,  // 468
                                           -2.268797106511077e-01,  // 469
                                           4.136129124162319e-03,   // 470
                                           1.492035685481084e-06,   // 471
                                           -8.019096316252705e-08,  // 472
                                           -3.884836318335974e-01,  // 473
                                           6.018241784823790e-09,   // 474
                                           5.187990561080906e-04,   // 475
                                           -8.274117776416746e+00,  // 476
                                           2.654593365327050e-01,   // 477
                                           -4.136595670519350e+00,  // 478
                                           4.325987063134314e-04,   // 479
                                           -2.134023627495818e-03,  // 480
                                           -2.215171402314955e+01,  // 481
                                           -6.615544475051536e-01,  // 482
                                           5.620756330420532e-02,   // 483
                                           -1.699783776993634e-03,  // 484
                                           -8.582546277185533e+01,  // 485
                                           1.182649510601675e-05,   // 486
                                           9.689643910799675e-02,   // 487
                                           -9.539397286832182e-01,  // 488
                                           -1.616701430565796e-04,  // 489
                                           -3.954224885648760e-02,  // 490
                                           -2.322780956432607e-04,  // 491
                                           -2.413304945959056e-03,  // 492
                                           2.386928974759160e-02,   // 493
                                           6.836432660725686e-12,   // 494
                                           -2.221451951982343e-05,  // 495
                                           2.425736932473198e-07,   // 496
                                           1.243810171631405e-09,   // 497
                                           1.291889524333180e-09,   // 498
                                           2.225683370750293e-03,   // 499
                                           5.836856057495053e-02,   // 500
                                           7.690248839360337e-03,   // 501
                                           6.358716349595339e-02,   // 502
                                           2.049084482283424e-03,   // 503
                                           -6.206830820850517e-02,  // 504
                                           -1.511867848568585e+01,  // 505
                                           7.327390684576026e-04,   // 506
                                           -3.040564718669812e+01,  // 507
                                           5.302688103562676e-05,   // 508
                                           -2.491164280096005e-05,  // 509
                                           1.643030173004734e-01,   // 510
                                           2.473678734908016e-03,   // 511
                                           2.450827532519911e-06,   // 512
                                           -5.536151726566601e-02,  // 513
                                           -5.268117931041482e-01,  // 514
                                           -1.652237682644735e-07,  // 515
                                           2.370865167332798e-04,   // 516
                                           -2.206545990763932e-06,  // 517
                                           -6.283209685913830e-05,  // 518
                                           -1.014628746338306e+00,  // 519
                                           4.762071066375403e-01,   // 520
                                           3.658869504908536e-08,   // 521
                                           -7.752946195412668e-05,  // 522
                                           -7.638511481991555e+00,  // 523
                                           -6.226474717231463e+01,  // 524
                                           -3.867116445341075e-02,  // 525
                                           9.126045144352800e-04,   // 526
                                           1.236700317082181e-06,   // 527
                                           5.322171915121240e-03,   // 528
                                           1.943351525698926e-01,   // 529
                                           5.582563747036821e-06,   // 530
                                           -1.511492945564123e-07,  // 531
                                           -1.398391430010333e-04,  // 532
                                           1.144509740718265e-05,   // 533
                                           2.931566495166680e-07,   // 534
                                           -1.670815090361374e-05,  // 535
                                           -4.548410059966419e-02,  // 536
                                           7.971268954588927e-02,   // 537
                                           4.630214865923634e+01,   // 538
                                           -1.429743509426220e-06,  // 539
                                           6.556224662942063e-03,   // 540
                                           2.778926875563139e-01,   // 541
                                           -1.573306672662650e-07,  // 542
                                           2.581419975670701e-07,   // 543
                                           7.827346575798813e-02,   // 544
                                           -7.413905164505729e-06,  // 545
                                           -1.380095079802321e-05,  // 546
                                           -1.587308309316436e-05,  // 547
                                           -3.370978867019237e-06,  // 548
                                           -9.716088006734022e+00,  // 549
                                           -2.767459968131634e+01,  // 550
                                           -1.079713113355938e-05,  // 551
                                           -5.740496869361933e-03,  // 552
                                           -2.644435457384270e-03,  // 553
                                           -7.735736809034270e-06,  // 554
                                           -2.960258646618776e-02,  // 555
                                           7.601416998297345e-05,   // 556
                                           -8.418183845098468e-03,  // 557
                                           5.946512862749190e-02,   // 558
                                           4.402595012251383e-01,   // 559
                                           -4.916382032875603e-05,  // 560
                                           -8.137150309308886e-07,  // 561
                                           9.347939623996066e-05,   // 562
                                           1.832031765126610e-05,   // 563
                                           8.304450008736357e-06,   // 564
                                           -9.224080714138239e-03,  // 565
                                           1.627339619411025e-05,   // 566
                                           4.488736582574842e-03,   // 567
                                           5.611197872931683e-03,   // 568
                                           4.342253385312267e-01,   // 569
                                           2.153234082231163e-04,   // 570
                                           1.092613857966768e-04,   // 571
                                           1.963443254954655e-01,   // 572
                                           8.915609713389738e-03,   // 573
                                           -8.514625276814546e+01,  // 574
                                           1.528703138233049e-09,   // 575
                                           2.783608431847554e-06,   // 576
                                           1.098468057587305e-02,   // 577
                                           1.379627315745078e+02,   // 578
                                           1.748044147184089e-02,   // 579
                                           -1.253985192965942e-06,  // 580
                                           -2.884797154591000e-05,  // 581
                                           6.778928921698869e-04,   // 582
                                           -1.043723436376500e-01,  // 583
                                           -1.624662755869157e-10,  // 584
                                           -4.230223854280555e-05,  // 585
                                           4.172940871268416e-04,   // 586
                                           -4.797646765321448e-04,  // 587
                                           -1.229897087841099e-06,  // 588
                                           2.446706090484618e+02,   // 589
                                           -1.021065108732475e-05,  // 590
                                           -1.349208502620430e+01,  // 591
                                           1.519650872588359e+00,   // 592
                                           -6.952688612151635e-02,  // 593
                                           -3.837769137566403e-02,  // 594
                                           -9.235666241588734e-04,  // 595
                                           -1.747031629827783e-01,  // 596
                                           -1.694415962257173e+02,  // 597
                                           7.705390998255506e-01,   // 598
                                           2.808440335733768e-05,   // 599
                                           -4.426775298197457e-09,  // 600
                                           8.440874919715361e+00,   // 601
                                           1.538526396365441e-02};  // 602

        m_k_intra_AB = 1.560064502158951e+00;  // A^(-1))
        m_d_intra_AB = 3.809943583391163e+00;  // A^(-1))
        m_k_intra_BB = 3.569794372614672e+00;  // A^(-1))
        m_d_intra_BB = 4.198186998841849e+00;  // A^(-1))
        m_k_intra_CD = 1.350063394024378e+00;  // A^(-1))
        m_d_intra_CD = 4.943173368726612e+00;  // A^(-1))
        m_k_intra_DD = 1.894874752874153e+00;  // A^(-1))
        m_d_intra_DD = 1.337692567910604e+00;  // A^(-1))
        m_k_AC = 1.663112146000257e+00;        // A^(-1))
        m_d_AC = 3.107087312398770e+00;        // A^(-1))
        m_k_AD = 1.434868920310018e+00;        // A^(-1))
        m_d_AD = 6.036099559438964e+00;        // A^(-1))
        m_k_BC = 1.429594770313886e+00;        // A^(-1))
        m_d_BC = 3.765769052643251e+00;        // A^(-1))
        m_k_BD = 6.823794509118249e-01;        // A^(-1))
        m_d_BD = 3.671809752297243e+00;        // A^(-1))
        m_k_CZ = 1.492514625332121e+00;        // A^(-1))
        m_d_CZ = 1.981058080567919e+00;        // A^(-1))
        m_k_DZ = 4.198994488504421e-01;        // A^(-1))
        m_d_DZ = 5.616308684089448e+00;        // A^(-1))
        m_r2i = 8.000000000000000e+00;         // A
        m_r2f = 9.000000000000000e+00;         // A
    }

    if (mon1 == "h2o" && mon2 == "ch4") {
        coefficients = std::vector<double>{-4.705592178443418e+00,  // 0
                                           5.304215547050470e+01,   // 1
                                           1.307267101044928e+02,   // 2
                                           -9.667264117687289e+01,  // 3
                                           -4.424051457757592e+01,  // 4
                                           1.632493590431310e+02,   // 5
                                           -1.023403530957030e+02,  // 6
                                           5.259303972326240e-01,   // 7
                                           -4.521852169450543e+01,  // 8
                                           -1.839632260407622e+00,  // 9
                                           4.760818752636861e+00,   // 10
                                           -1.621456870441988e+00,  // 11
                                           -7.316935814377310e-01,  // 12
                                           1.341031506658764e+01,   // 13
                                           1.871555986440542e-01,   // 14
                                           -6.727923523975636e+01,  // 15
                                           -2.955268602303643e+01,  // 16
                                           2.523917737149420e+01,   // 17
                                           4.143719157321728e+01,   // 18
                                           -2.178658831771795e+00,  // 19
                                           1.068550735357830e+01,   // 20
                                           3.697203209677283e+01,   // 21
                                           -7.755565349467365e-01,  // 22
                                           3.806392147976698e+00,   // 23
                                           -3.397793051515942e+01,  // 24
                                           9.495517635897745e+00,   // 25
                                           1.220273579127994e+01,   // 26
                                           -9.123234822062680e+01,  // 27
                                           -4.830235482949751e+00,  // 28
                                           -5.531438565657245e+01,  // 29
                                           9.053140750273705e+00,   // 30
                                           -3.195638922240021e+00,  // 31
                                           8.275980389820683e+00,   // 32
                                           4.322980649045744e-01,   // 33
                                           -4.994937628247374e+01,  // 34
                                           1.154432523185302e+01,   // 35
                                           2.755088993586059e-01,   // 36
                                           1.291957932902036e-01,   // 37
                                           -1.268000874960676e+02,  // 38
                                           -2.082916736406626e+00,  // 39
                                           -2.151226252886438e+00,  // 40
                                           6.292156386755779e+01,   // 41
                                           6.228913425849193e-01,   // 42
                                           -9.270810545818379e+01,  // 43
                                           -1.422613501040533e+01,  // 44
                                           9.903605496862212e+01,   // 45
                                           -7.336825945357381e+01,  // 46
                                           -6.795944995354282e-03,  // 47
                                           1.583313000241620e+00,   // 48
                                           1.940782871272852e+02,   // 49
                                           2.909683819231224e+00,   // 50
                                           2.234079287540814e+02,   // 51
                                           9.254215438857626e+00,   // 52
                                           4.963948099526669e+00,   // 53
                                           1.455836338781378e+01,   // 54
                                           -4.407347800030206e+01,  // 55
                                           4.663163620847556e+01,   // 56
                                           4.204943580130644e+01,   // 57
                                           9.283960343503432e+00,   // 58
                                           1.445677772634533e+01,   // 59
                                           -3.869921035746166e+00,  // 60
                                           3.452292496432445e+00,   // 61
                                           -2.022968395250265e+01,  // 62
                                           -5.171195533598306e+01,  // 63
                                           -7.526690846723185e-01,  // 64
                                           -1.493929965323646e+01,  // 65
                                           -5.632164128617023e+01,  // 66
                                           -9.014294226846763e+00,  // 67
                                           2.063384211685013e+02,   // 68
                                           -7.421539262671413e+01,  // 69
                                           9.013068221558430e+01,   // 70
                                           5.094956607803381e+01,   // 71
                                           4.401703647378475e+00,   // 72
                                           4.081119804055404e-02,   // 73
                                           -2.101850882200347e+00,  // 74
                                           -3.189618132552691e+00,  // 75
                                           -6.911955506475770e-01,  // 76
                                           -5.003454556746552e-01,  // 77
                                           -1.525345279071508e-01,  // 78
                                           -1.424626260437993e+00,  // 79
                                           4.410232102692155e-01,   // 80
                                           5.807172064889892e-01,   // 81
                                           -4.000617972424005e+00,  // 82
                                           8.951000541610720e-01,   // 83
                                           -1.997748326142698e-01,  // 84
                                           8.438341783581622e-01,   // 85
                                           -2.121869212357891e-01,  // 86
                                           -9.178721816779011e-01,  // 87
                                           1.627167637089397e-02,   // 88
                                           -8.825156171078492e+00,  // 89
                                           2.441572148315791e+00,   // 90
                                           -3.876345314398955e+00,  // 91
                                           -1.081745716357910e-01,  // 92
                                           3.344448259094748e-02,   // 93
                                           2.426537056533830e-01,   // 94
                                           -2.166720120528979e-02,  // 95
                                           -6.267240218260751e-02,  // 96
                                           1.024808060820017e-01,   // 97
                                           3.617422423433428e-01,   // 98
                                           7.741627538399402e-01,   // 99
                                           8.447021814320734e-01,   // 100
                                           4.276040727819284e-01,   // 101
                                           -1.268247068547107e-01,  // 102
                                           5.404624697314897e+01,   // 103
                                           2.068417599968188e-01,   // 104
                                           3.031550292053070e-02,   // 105
                                           1.353066042609813e-02,   // 106
                                           -2.610975317736229e-03,  // 107
                                           -2.822958531906605e-01,  // 108
                                           -7.008302904602706e-02,  // 109
                                           -2.026245749650493e-01,  // 110
                                           -4.077873490034666e+00,  // 111
                                           7.693342466648337e-01,   // 112
                                           -4.525178787090274e-01,  // 113
                                           -2.033889010330584e+00,  // 114
                                           -2.387396563053294e+00,  // 115
                                           2.323278591273399e-02,   // 116
                                           -5.497212299717750e-03,  // 117
                                           -1.190319131622155e-01,  // 118
                                           -2.826737442528068e+00,  // 119
                                           3.079832557396597e-02,   // 120
                                           1.393218549642157e+00,   // 121
                                           -3.905106465778448e+00,  // 122
                                           3.630658877504546e-01,   // 123
                                           1.361354812492386e+00,   // 124
                                           1.464915245344310e+00,   // 125
                                           -2.792683246980551e-01,  // 126
                                           1.563910923496027e-01,   // 127
                                           8.148262963908188e-01,   // 128
                                           1.149238057033825e-02,   // 129
                                           1.225532672965490e+01,   // 130
                                           2.076749724654203e-03,   // 131
                                           1.355935690483371e-01,   // 132
                                           6.111354974477125e-01,   // 133
                                           -2.026877399524514e+00,  // 134
                                           -4.175323572030989e-03,  // 135
                                           1.927398936824205e-02,   // 136
                                           1.466259251619041e-02,   // 137
                                           -1.445677490135527e-01,  // 138
                                           -2.471817544224844e-03,  // 139
                                           -8.080667973393098e-02,  // 140
                                           6.185688103467492e-01,   // 141
                                           1.225782116826079e-01,   // 142
                                           -5.300754751102789e+00,  // 143
                                           2.091428106630379e-01,   // 144
                                           -3.485344444014817e-01,  // 145
                                           -2.649903780507658e-02,  // 146
                                           -6.384109140118753e-02,  // 147
                                           -1.722787380998847e+00,  // 148
                                           2.509158669810196e-02,   // 149
                                           1.359053490558949e-02,   // 150
                                           1.811728865035012e-01,   // 151
                                           7.110285605944679e-02,   // 152
                                           6.845621451256730e-02,   // 153
                                           1.548634296466449e+01,   // 154
                                           -7.840356359841778e-02,  // 155
                                           2.140244104317886e+00,   // 156
                                           -7.109497021725079e-02,  // 157
                                           2.059732541587643e-01,   // 158
                                           3.833529651261598e-04,   // 159
                                           -3.570894293695299e+01,  // 160
                                           -8.864295932763844e-02,  // 161
                                           3.571700066408977e+00,   // 162
                                           -8.718315708127013e-02,  // 163
                                           -5.677771964746964e-01,  // 164
                                           4.707113924433722e+00,   // 165
                                           -8.088301173999487e-01,  // 166
                                           -1.212623258661404e-02,  // 167
                                           8.335880486040052e-02,   // 168
                                           -1.950050385736675e-02,  // 169
                                           2.939583600238971e-01,   // 170
                                           7.126504396941599e-02,   // 171
                                           5.516467501273341e+00,   // 172
                                           -6.398242680084240e-02,  // 173
                                           2.931895832745831e+00,   // 174
                                           4.098470656763507e-03,   // 175
                                           -3.095151377099442e-01,  // 176
                                           -1.215531448857752e-02,  // 177
                                           3.903517356297966e+00,   // 178
                                           -3.188737051564245e-01,  // 179
                                           1.695249192453746e-01,   // 180
                                           2.099819386238003e-02,   // 181
                                           9.791406036581072e-03,   // 182
                                           -2.019524004190341e+00,  // 183
                                           -4.588763864216849e-02,  // 184
                                           4.276559480207237e-01,   // 185
                                           -3.495836336063903e-01,  // 186
                                           -1.018381130173697e-02,  // 187
                                           3.572568088138501e-01,   // 188
                                           5.767839130105550e-03,   // 189
                                           -6.984176330780163e-01,  // 190
                                           -9.878707560357302e-01,  // 191
                                           -1.298154077408546e+00,  // 192
                                           -3.092814055405412e+00,  // 193
                                           2.096080124557661e+00,   // 194
                                           -3.615278580552865e-03,  // 195
                                           -9.351838911707325e-01,  // 196
                                           2.172502859416511e+00,   // 197
                                           1.010620705501400e-01,   // 198
                                           1.304120053551796e+00,   // 199
                                           7.982146175931639e-04,   // 200
                                           1.220876408727107e-01,   // 201
                                           -1.601154785570905e+00,  // 202
                                           1.255791746656147e-02,   // 203
                                           1.606383998690636e-02,   // 204
                                           1.400416851652825e-01,   // 205
                                           8.796717834637031e-02,   // 206
                                           -2.719021208014407e+00,  // 207
                                           -9.409319828788018e-01,  // 208
                                           1.495673093558093e-02,   // 209
                                           5.303167317937178e+00,   // 210
                                           1.883593031755596e+00,   // 211
                                           -3.575534805569621e+00,  // 212
                                           -1.387340178222192e+00,  // 213
                                           1.711393577169160e+01,   // 214
                                           -7.315822788917395e-03,  // 215
                                           -5.991055838902352e-01,  // 216
                                           3.562652492455821e-02,   // 217
                                           1.094019891783345e-02,   // 218
                                           1.184962492011174e-01,   // 219
                                           -7.421462518432982e-01,  // 220
                                           1.400543000366830e-01,   // 221
                                           -3.675069116920130e-01,  // 222
                                           -4.731022874148011e-03,  // 223
                                           -4.581655417165186e-02,  // 224
                                           1.217418468892945e+00,   // 225
                                           -6.322290483957567e-01,  // 226
                                           -1.336861111875000e-03,  // 227
                                           -1.624041677983575e-01,  // 228
                                           -5.283434114758753e-03,  // 229
                                           5.465476228882124e-02,   // 230
                                           3.120550579921800e-03,   // 231
                                           -6.224913593761997e-02,  // 232
                                           -5.814431864705346e-01,  // 233
                                           -3.229983916086273e+00,  // 234
                                           -1.704879935735906e-01,  // 235
                                           -1.006270653049414e-01,  // 236
                                           1.217811688458444e-02,   // 237
                                           -4.210258572918717e-02,  // 238
                                           9.892058254651720e-02,   // 239
                                           -3.001497067916478e-02,  // 240
                                           1.507270421224790e-02,   // 241
                                           1.444523957869866e+00,   // 242
                                           -9.469438331658797e-01,  // 243
                                           1.006571492191906e+00,   // 244
                                           -2.507054872960604e+00,  // 245
                                           -6.336598763647506e-01,  // 246
                                           1.063410899234350e+00,   // 247
                                           -1.059822744010955e-01,  // 248
                                           -3.002041895061117e-02,  // 249
                                           3.250745152820275e-01,   // 250
                                           1.135821684690450e-01,   // 251
                                           1.495455898657318e-02,   // 252
                                           -3.384264297325123e+00,  // 253
                                           1.099738748688277e+00,   // 254
                                           -9.416682896788570e+00,  // 255
                                           -1.075832691691698e-01,  // 256
                                           -6.477408094998539e-02,  // 257
                                           -1.351518477355997e-01,  // 258
                                           -6.440995416658325e-02,  // 259
                                           -5.312012886288985e+01,  // 260
                                           -6.256214414894001e-01,  // 261
                                           4.772303352265856e+00,   // 262
                                           -1.242423135390121e-01,  // 263
                                           7.670016106723980e-01,   // 264
                                           -7.604209243980501e-04,  // 265
                                           1.281030619200715e+01,   // 266
                                           3.104957945143527e-04,   // 267
                                           3.035003604669928e-01,   // 268
                                           -4.204901052852855e-02,  // 269
                                           1.805740057628093e-02,   // 270
                                           -6.106751944194986e-02,  // 271
                                           -1.634355516729898e+00,  // 272
                                           2.371136971124606e-03,   // 273
                                           -1.001491660871248e+01,  // 274
                                           -3.550295326371692e-01,  // 275
                                           -7.919742063273032e-02,  // 276
                                           1.059416747079023e+01,   // 277
                                           4.247836564315318e-01,   // 278
                                           4.351814629379741e-02,   // 279
                                           1.171245575904907e+00,   // 280
                                           -2.518107568975460e-02,  // 281
                                           5.456914028367212e-02,   // 282
                                           6.889903224694380e-03,   // 283
                                           -9.451420258576189e-01,  // 284
                                           -2.430328539322727e-03,  // 285
                                           2.585465761767173e-02,   // 286
                                           -8.830159293129611e-05,  // 287
                                           6.540003883944109e-03,   // 288
                                           -1.814400400676306e-01,  // 289
                                           -5.493253558232317e+00,  // 290
                                           1.016890022190865e+01,   // 291
                                           -4.670718354423862e-01,  // 292
                                           3.084087460427012e-01,   // 293
                                           1.836557128924515e-01,   // 294
                                           1.238429753823462e-01,   // 295
                                           -1.957573486744821e-02,  // 296
                                           8.119575774829349e-02,   // 297
                                           1.691880093857746e-02,   // 298
                                           4.177589119017283e+00,   // 299
                                           2.742748450664810e-02,   // 300
                                           -3.118367849811000e+01,  // 301
                                           -1.366985622444181e-01,  // 302
                                           5.781522504155058e+01,   // 303
                                           2.959189454237010e-02,   // 304
                                           5.013592070631473e-01,   // 305
                                           4.300221992329900e-02,   // 306
                                           1.676062014859930e-03,   // 307
                                           -2.592696746977677e-02,  // 308
                                           1.158235642561772e+01,   // 309
                                           -8.650413694802354e-01,  // 310
                                           -1.072874269292950e+00,  // 311
                                           -7.653310947668827e-01,  // 312
                                           2.333076386554086e-01,   // 313
                                           1.842805368658262e+00,   // 314
                                           5.080391739662585e-01,   // 315
                                           2.042742213810687e-02,   // 316
                                           1.494382129633854e-01,   // 317
                                           -1.485046256633529e+00,  // 318
                                           6.590311450129834e-01,   // 319
                                           -4.176124125105776e-01,  // 320
                                           4.186801309486265e-03,   // 321
                                           -4.246384468017719e-01,  // 322
                                           3.192411974623693e-01,   // 323
                                           -3.668080438616008e+00,  // 324
                                           -2.290585911895729e+00,  // 325
                                           8.941711269361848e+00,   // 326
                                           4.825421501055178e-01,   // 327
                                           -5.478585545023000e-01,  // 328
                                           1.260547001977193e+00,   // 329
                                           2.731591090841679e+00,   // 330
                                           2.215284251954404e-01,   // 331
                                           2.156579511565071e-01,   // 332
                                           2.319338823979965e-01,   // 333
                                           8.087257049086837e-01,   // 334
                                           3.255588971324979e-01,   // 335
                                           -1.105771153377931e-01,  // 336
                                           -1.766740786574426e-01,  // 337
                                           2.094801425534221e+00,   // 338
                                           -2.090275508817963e-01,  // 339
                                           9.319872484969803e+00,   // 340
                                           -4.156785131171070e-01,  // 341
                                           5.621292273348913e-01,   // 342
                                           -8.408336351154590e-02,  // 343
                                           2.229036135013333e-01,   // 344
                                           -1.469413754138559e+00,  // 345
                                           -6.817140287902390e-02,  // 346
                                           1.401231778062584e+00,   // 347
                                           -1.706595727606174e-02,  // 348
                                           -2.674979693934247e-02,  // 349
                                           -4.850583796089836e-02,  // 350
                                           1.099529118523697e-02,   // 351
                                           -1.887387207696791e+00,  // 352
                                           -1.287269198817168e-01,  // 353
                                           7.132926469820766e-02,   // 354
                                           1.368353803474361e+00,   // 355
                                           3.758181388401994e+00,   // 356
                                           -1.352391962329961e+00,  // 357
                                           2.044320192019511e-01,   // 358
                                           -3.574835894082201e-02,  // 359
                                           1.764818226237686e-02,   // 360
                                           -2.830340182899350e-01,  // 361
                                           9.960271046132452e-01,   // 362
                                           8.874769596038947e-03,   // 363
                                           -2.061266145729648e-02,  // 364
                                           -1.686440906457002e+00,  // 365
                                           6.046434863746448e+01,   // 366
                                           -8.497714281827596e+00,  // 367
                                           1.848273125202301e+00,   // 368
                                           -1.374761044546981e+00,  // 369
                                           -3.713969928188580e-01,  // 370
                                           -9.338541319629135e+00,  // 371
                                           6.529456603967132e+00,   // 372
                                           -4.927128392115831e-01,  // 373
                                           3.018082657610661e-01,   // 374
                                           -2.881477969511409e-01,  // 375
                                           2.185273078817079e+00,   // 376
                                           4.474803778483034e+00,   // 377
                                           1.801487515353195e-01,   // 378
                                           5.898476174681678e-03,   // 379
                                           1.759767218139110e+00,   // 380
                                           -3.496936804631408e-02,  // 381
                                           -4.377809728664659e+00,  // 382
                                           -8.821231764996322e-03,  // 383
                                           5.234939628318133e-01,   // 384
                                           5.343288022070359e-01,   // 385
                                           8.603182782043726e-02,   // 386
                                           -9.858668170332433e-03,  // 387
                                           7.318848929228123e-03,   // 388
                                           6.043208639137611e-01,   // 389
                                           9.856441177264533e-01,   // 390
                                           2.720047877942725e+00,   // 391
                                           4.290572290795938e-02,   // 392
                                           2.289740650489357e-01,   // 393
                                           5.133655201424382e+00,   // 394
                                           -2.358572040003137e-03,  // 395
                                           3.238468982771132e-01,   // 396
                                           7.407500892078273e-02,   // 397
                                           2.364810427906772e+00,   // 398
                                           -2.454167225692113e-01,  // 399
                                           -1.579338491629098e-02,  // 400
                                           3.137697935876042e-02,   // 401
                                           9.363212322507733e-01,   // 402
                                           3.160085053929223e-03,   // 403
                                           -4.362388062025704e-02,  // 404
                                           -3.338148270491047e-01,  // 405
                                           3.512433277313212e+00,   // 406
                                           -2.252450708458283e-02,  // 407
                                           -3.835063389336102e-01,  // 408
                                           1.093558028976510e+00,   // 409
                                           3.829511961659459e+00,   // 410
                                           7.900677297102627e-01,   // 411
                                           3.421815445691257e+01,   // 412
                                           1.377847537253023e-01,   // 413
                                           4.980561292532246e-01,   // 414
                                           8.050001952319746e-01,   // 415
                                           -5.141361799439420e+01,  // 416
                                           3.292159689543247e-03,   // 417
                                           5.114322237662763e+00,   // 418
                                           8.650815702609180e-01,   // 419
                                           2.030376497915853e-02,   // 420
                                           -9.792235453382848e-03,  // 421
                                           -4.224620482328802e-01,  // 422
                                           1.023448531810314e-01,   // 423
                                           1.030049353845745e-01,   // 424
                                           -5.366121348569571e+00,  // 425
                                           3.689416179638266e-02,   // 426
                                           6.062451886289358e-03,   // 427
                                           2.177327904510579e+00,   // 428
                                           -9.626955046430390e-03,  // 429
                                           -2.999582964930025e-01,  // 430
                                           2.283605241371751e+00,   // 431
                                           5.145056352885896e+00,   // 432
                                           5.406884888261351e-02,   // 433
                                           -3.020301865087003e+00,  // 434
                                           -1.241446436011850e+01,  // 435
                                           -4.641059593738930e-01,  // 436
                                           6.341509870381919e-02,   // 437
                                           -1.963354665148274e+00,  // 438
                                           -3.941841436855779e-02,  // 439
                                           1.383309114472098e-02,   // 440
                                           -1.123661606311934e-02,  // 441
                                           1.568569213012520e+00,   // 442
                                           -4.941838443772771e-01,  // 443
                                           -6.268776170162933e+00,  // 444
                                           -2.604612869824214e+00,  // 445
                                           5.180786778487170e-01,   // 446
                                           -2.045916385846823e+00,  // 447
                                           -1.985127580754677e+00,  // 448
                                           -2.038196961777038e-01,  // 449
                                           4.876707599412813e+01,   // 450
                                           -2.555504401153750e-01,  // 451
                                           4.927736791029003e-01,   // 452
                                           -3.455244691029308e+00,  // 453
                                           -5.059307941135180e-01,  // 454
                                           -3.285896186604931e+00,  // 455
                                           1.644207440752399e+00,   // 456
                                           2.030835190414584e-01,   // 457
                                           5.504727705826483e+00,   // 458
                                           -2.064326594590772e-01,  // 459
                                           -8.183794481245146e+00,  // 460
                                           -2.977334561766398e+01,  // 461
                                           -5.140552718271685e-02,  // 462
                                           -1.808725084427733e+01,  // 463
                                           -4.248635853196274e+00,  // 464
                                           -6.185445141106429e+00,  // 465
                                           -2.080970056172712e+00,  // 466
                                           3.218699469735636e-01,   // 467
                                           8.106353328117929e-03,   // 468
                                           -3.479044772871974e+00,  // 469
                                           -3.177149102065555e-04,  // 470
                                           -1.341507751467198e-01,  // 471
                                           -5.749088893557610e+00,  // 472
                                           -3.334476078142693e-02,  // 473
                                           2.479742435882250e+00,   // 474
                                           9.588686900431721e+00,   // 475
                                           -1.398723853853107e-01,  // 476
                                           -2.706814046039642e+00,  // 477
                                           -5.800182780593342e-05,  // 478
                                           -6.587588567555099e-02,  // 479
                                           -1.810582689002940e-03,  // 480
                                           -5.868672417873918e-03,  // 481
                                           -1.593975818472134e+00,  // 482
                                           6.732513625149815e+00,   // 483
                                           4.437753023123531e-02,   // 484
                                           6.258598929334948e-02,   // 485
                                           -1.275653009320152e+00,  // 486
                                           6.248264650090742e-01,   // 487
                                           -1.806262327372135e-01,  // 488
                                           -1.852229956161319e+00,  // 489
                                           3.938165386162846e-03,   // 490
                                           -4.604199263494920e+00,  // 491
                                           -9.055111610432569e-01,  // 492
                                           3.777155983783160e+00,   // 493
                                           -6.559234641434908e+01,  // 494
                                           -1.010290736118795e-02,  // 495
                                           -1.367714965447774e-01,  // 496
                                           -4.157854781414623e+00,  // 497
                                           -8.118972888069212e+00,  // 498
                                           1.373737238452178e+00,   // 499
                                           -6.074079768047726e+00,  // 500
                                           -4.336385284409348e+00,  // 501
                                           4.925404238319448e-02,   // 502
                                           1.873130961148715e-01,   // 503
                                           5.448002643910384e-04,   // 504
                                           -3.463362463618522e-01,  // 505
                                           -2.157197404879674e-03,  // 506
                                           1.881450500544283e-01,   // 507
                                           2.147493124107283e+01,   // 508
                                           -3.725163163146398e-01,  // 509
                                           -1.176292861289991e-02,  // 510
                                           4.705738258420285e-02,   // 511
                                           -5.331948580449724e+00,  // 512
                                           7.983665545548095e-03,   // 513
                                           -3.895433499666630e+00,  // 514
                                           -2.027060968863004e-01,  // 515
                                           -9.308771526164457e-02,  // 516
                                           -1.548786693198495e-01,  // 517
                                           1.857836314045294e-01,   // 518
                                           -1.795617775848295e-02,  // 519
                                           -4.879456343839928e+00,  // 520
                                           -2.188192608181230e+01,  // 521
                                           -4.026923832323735e+01,  // 522
                                           -6.888468392287146e-02,  // 523
                                           8.656892214595171e+00,   // 524
                                           1.383818081894946e+01,   // 525
                                           7.455631662982899e+00,   // 526
                                           2.735369723116229e-01,   // 527
                                           1.531694807664486e-01,   // 528
                                           -5.923228100996308e-02,  // 529
                                           3.793319315500690e-01,   // 530
                                           -7.030702943585080e-01,  // 531
                                           3.204383940918195e+00,   // 532
                                           -1.216156306495532e+00,  // 533
                                           -4.107343971190600e+00,  // 534
                                           -3.464731984290752e-01,  // 535
                                           -2.344517406885198e-01,  // 536
                                           1.767967381508593e-01,   // 537
                                           2.915344400313760e+01,   // 538
                                           -9.570040333442979e+01,  // 539
                                           -6.377833538949563e-01,  // 540
                                           1.117587388828846e-01,   // 541
                                           2.829689820870680e+00,   // 542
                                           3.711152483613158e+00,   // 543
                                           3.534478128712512e+00,   // 544
                                           8.633585720612046e-02,   // 545
                                           1.184098894011909e-01,   // 546
                                           -9.123105951696944e-01,  // 547
                                           3.350478780585447e+00,   // 548
                                           1.736074057665078e+00,   // 549
                                           1.541842398396763e-01,   // 550
                                           -1.002006056828860e-01,  // 551
                                           -1.305188437602370e+00,  // 552
                                           -1.669416590641297e+00,  // 553
                                           8.086400819718569e-02,   // 554
                                           -5.905626832265501e-01,  // 555
                                           -4.066682153638159e+01,  // 556
                                           8.074604515187499e-04,   // 557
                                           -1.580683782554064e+00,  // 558
                                           -2.372191471676842e-02,  // 559
                                           6.433269225911292e-01,   // 560
                                           5.804033152685970e+00,   // 561
                                           1.187655708276600e+00,   // 562
                                           5.379443626002454e-03,   // 563
                                           2.212883844384310e-01,   // 564
                                           9.987091022338287e-02,   // 565
                                           2.405346833436147e+01,   // 566
                                           1.740308760337473e-01,   // 567
                                           -4.232771416245833e-02,  // 568
                                           -1.090895276781242e+00,  // 569
                                           2.981704569116016e-01,   // 570
                                           -1.510251454734733e-01,  // 571
                                           2.760091867549163e-03,   // 572
                                           5.436894463792704e-02,   // 573
                                           -1.089513790572363e-01,  // 574
                                           1.414062625918333e+01,   // 575
                                           2.078161598718186e-01,   // 576
                                           -1.896099956447799e-01,  // 577
                                           1.560034045746270e-01,   // 578
                                           -6.143497693355704e-01,  // 579
                                           -8.332624907706151e+00,  // 580
                                           -1.197404535178031e-01,  // 581
                                           5.304671647290613e-01,   // 582
                                           1.475342597795563e+01,   // 583
                                           -4.573960887210238e+01,  // 584
                                           2.131785886458007e+00,   // 585
                                           4.187351969610376e+01,   // 586
                                           -8.991789510628198e-01,  // 587
                                           4.009813144021417e+01,   // 588
                                           1.489400104444339e-01,   // 589
                                           -2.646518797917393e+01,  // 590
                                           -1.925071888915734e-01,  // 591
                                           4.540145801210142e-01,   // 592
                                           -9.338238530790431e-02,  // 593
                                           -6.383814484245158e-01,  // 594
                                           -9.220226360523577e-01,  // 595
                                           -1.017794860655669e+00,  // 596
                                           -6.148565979405152e-03,  // 597
                                           -1.855425433851564e-01,  // 598
                                           4.317849492767627e+00,   // 599
                                           8.636859064874471e+01,   // 600
                                           -3.442973722470187e-02,  // 601
                                           1.055338502136508e+00};  // 602

        m_k_intra_AB = 7.981769253199138e-01;  // A^(-1))
        m_d_intra_AB = 4.040819683827504e+00;  // A^(-1))
        m_k_intra_BB = 2.579463880579890e-01;  // A^(-1))
        m_d_intra_BB = 2.377019586697373e+00;  // A^(-1))
        m_k_intra_CD = 3.688427221099756e-01;  // A^(-1))
        m_d_intra_CD = 4.333852019203771e+00;  // A^(-1))
        m_k_intra_DD = 7.091344939292101e-01;  // A^(-1))
        m_d_intra_DD = 3.168984322065454e+00;  // A^(-1))
        m_k_AC = 1.564512113339641e+00;        // A^(-1))
        m_d_AC = 3.257864349051078e+00;        // A^(-1))
        m_k_AD = 6.622458897222858e-01;        // A^(-1))
        m_d_AD = 3.893753782478246e+00;        // A^(-1))
        m_k_BC = 1.206761651281590e+00;        // A^(-1))
        m_d_BC = 2.837093011555366e+00;        // A^(-1))
        m_k_BD = 7.972437249347342e-01;        // A^(-1))
        m_d_BD = 5.352114146493275e+00;        // A^(-1))
        m_k_CZ = 1.291962400963017e+00;        // A^(-1))
        m_d_CZ = 4.726091329507012e+00;        // A^(-1))
        m_k_DZ = 4.825788863998004e-01;        // A^(-1))
        m_d_DZ = 5.184523093153075e+00;        // A^(-1))
        m_r2i = 8.000000000000000e+00;         // A
        m_r2f = 9.000000000000000e+00;         // A
    }
}

double x2b_A1B2Z2_C1D4_v1x::f_switch(const double& r, double& g) const {
    if (r > m_r2f) {
        g = 0.0;
        return 0.0;
    } else if (r > m_r2i) {
        const double t1 = M_PI / (m_r2f - m_r2i);
        const double x = (r - m_r2i) * t1;
        g = -std::sin(x) * t1 / 2.0;
        return (1.0 + std::cos(x)) / 2.0;
    } else {
        g = 0.0;
        return 1.0;
    }
}

//----------------------------------------------------------------------------//

double x2b_A1B2Z2_C1D4_v1x::eval(const double* xyz1, const double* xyz2, const size_t ndim) const {
#ifdef DEBUG
    std::cerr << "\nEntering " << __func__ << " in " << __FILE__ << std::endl;
#endif

    std::vector<double> energies(ndim, 0.0);

    for (size_t j = 0; j < ndim; j++) {
        double mon1[9];
        double mon2[15];

        std::copy(xyz1 + j * 9, xyz1 + (j + 1) * 9, mon1);
        std::copy(xyz2 + j * 15, xyz2 + (j + 1) * 15, mon2);

        const double d12[3] = {mon1[0] - mon2[0], mon1[1] - mon2[1], mon1[2] - mon2[2]};

        const double r12sq = d12[0] * d12[0] + d12[1] * d12[1] + d12[2] * d12[2];
        const double r12 = std::sqrt(r12sq);

        if (r12 > m_r2f) continue;

        double xcrd[24];  // coordinates of real sites ONLY

        std::copy(mon1, mon1 + 9, xcrd);
        std::copy(mon2, mon2 + 15, xcrd + 9);

        double v[38];

        double sw = 0.0;
        double gsw = 0.0;

        const double* A_1_a = xcrd + 0;
        const double* B_1_a = xcrd + 3;
        const double* B_2_a = xcrd + 6;

        const double* C_1_b = xcrd + 9;
        const double* D_1_b = xcrd + 12;
        const double* D_2_b = xcrd + 15;
        const double* D_3_b = xcrd + 18;
        const double* D_4_b = xcrd + 21;

        double Z_1_a[3];
        double Z_2_a[3];

        //    vsites virt;
        double w12 = -9.721486914088159e-02;  // from MBpol
        double w13 = -9.721486914088159e-02;
        double wcross = 9.859272078406150e-02;

        monomer m;

        m.setup(A_1_a, w12, wcross, Z_1_a, Z_2_a);

        variable vr[38];

        v[0] = vr[0].v_exp0(m_d_intra_AB, m_k_intra_AB, A_1_a, B_1_a);
        v[1] = vr[1].v_exp0(m_d_intra_AB, m_k_intra_AB, A_1_a, B_2_a);
        v[2] = vr[2].v_exp0(m_d_intra_BB, m_k_intra_BB, B_1_a, B_2_a);

        v[3] = vr[3].v_exp0(m_d_intra_CD, m_k_intra_CD, C_1_b, D_1_b);
        v[4] = vr[4].v_exp0(m_d_intra_CD, m_k_intra_CD, C_1_b, D_2_b);
        v[5] = vr[5].v_exp0(m_d_intra_CD, m_k_intra_CD, C_1_b, D_3_b);
        v[6] = vr[6].v_exp0(m_d_intra_CD, m_k_intra_CD, C_1_b, D_4_b);
        v[7] = vr[7].v_exp0(m_d_intra_DD, m_k_intra_DD, D_1_b, D_2_b);
        v[8] = vr[8].v_exp0(m_d_intra_DD, m_k_intra_DD, D_1_b, D_3_b);
        v[9] = vr[9].v_exp0(m_d_intra_DD, m_k_intra_DD, D_1_b, D_4_b);
        v[10] = vr[10].v_exp0(m_d_intra_DD, m_k_intra_DD, D_2_b, D_3_b);
        v[11] = vr[11].v_exp0(m_d_intra_DD, m_k_intra_DD, D_2_b, D_4_b);
        v[12] = vr[12].v_exp0(m_d_intra_DD, m_k_intra_DD, D_3_b, D_4_b);

        v[13] = vr[13].v_exp0(m_d_AC, m_k_AC, A_1_a, C_1_b);
        v[14] = vr[14].v_exp0(m_d_AD, m_k_AD, A_1_a, D_1_b);
        v[15] = vr[15].v_exp0(m_d_AD, m_k_AD, A_1_a, D_2_b);
        v[16] = vr[16].v_exp0(m_d_AD, m_k_AD, A_1_a, D_3_b);
        v[17] = vr[17].v_exp0(m_d_AD, m_k_AD, A_1_a, D_4_b);

        v[18] = vr[18].v_exp0(m_d_BC, m_k_BC, B_1_a, C_1_b);
        v[19] = vr[19].v_exp0(m_d_BD, m_k_BD, B_1_a, D_1_b);
        v[20] = vr[20].v_exp0(m_d_BD, m_k_BD, B_1_a, D_2_b);
        v[21] = vr[21].v_exp0(m_d_BD, m_k_BD, B_1_a, D_3_b);
        v[22] = vr[22].v_exp0(m_d_BD, m_k_BD, B_1_a, D_4_b);

        v[23] = vr[23].v_exp0(m_d_BC, m_k_BC, B_2_a, C_1_b);
        v[24] = vr[24].v_exp0(m_d_BD, m_k_BD, B_2_a, D_1_b);
        v[25] = vr[25].v_exp0(m_d_BD, m_k_BD, B_2_a, D_2_b);
        v[26] = vr[26].v_exp0(m_d_BD, m_k_BD, B_2_a, D_3_b);
        v[27] = vr[27].v_exp0(m_d_BD, m_k_BD, B_2_a, D_4_b);

        v[28] = vr[28].v_coul0(m_d_CZ, m_k_CZ, Z_1_a, C_1_b);
        v[29] = vr[29].v_coul0(m_d_DZ, m_k_DZ, Z_1_a, D_1_b);
        v[30] = vr[30].v_coul0(m_d_DZ, m_k_DZ, Z_1_a, D_2_b);
        v[31] = vr[31].v_coul0(m_d_DZ, m_k_DZ, Z_1_a, D_3_b);
        v[32] = vr[32].v_coul0(m_d_DZ, m_k_DZ, Z_1_a, D_4_b);

        v[33] = vr[33].v_coul0(m_d_CZ, m_k_CZ, Z_2_a, C_1_b);
        v[34] = vr[34].v_coul0(m_d_DZ, m_k_DZ, Z_2_a, D_1_b);
        v[35] = vr[35].v_coul0(m_d_DZ, m_k_DZ, Z_2_a, D_2_b);
        v[36] = vr[36].v_coul0(m_d_DZ, m_k_DZ, Z_2_a, D_3_b);
        v[37] = vr[37].v_coul0(m_d_DZ, m_k_DZ, Z_2_a, D_4_b);

        sw = f_switch(r12, gsw);

        energies[j] = sw * polynomial::eval(coefficients.data(), v);
    }

    double energy = 0.0;
    for (size_t i = 0; i < ndim; i++) {
        energy += energies[i];
    }

#ifdef DEBUG
    std::cerr << std::scientific << std::setprecision(10);
    std::cerr << "\nExiting " << __func__ << " in " << __FILE__ << std::endl;
    std::cerr << "Input coordinates (1) for " << ndim << " monomers:\n";
    for (size_t i = 0; i < ndim; i++) {
        for (size_t j = 0; j < 9; j++) {
            std::cerr << xyz1[9 * i + j] << " , ";
        }
        std::cerr << std::endl;
    }
    std::cerr << "Input coordinates (2) for " << ndim << " monomers:\n";
    for (size_t i = 0; i < ndim; i++) {
        for (size_t j = 0; j < 15; j++) {
            std::cerr << xyz2[15 * i + j] << " , ";
        }
        std::cerr << std::endl;
    }
    std::cerr << "Output energy: " << energy << std::endl;
#endif

    return energy;
}

double x2b_A1B2Z2_C1D4_v1x::eval(const double* xyz1, const double* xyz2, double* grad1, double* grad2,
                                 const size_t ndim, std::vector<double>* virial) const {
#ifdef DEBUG
    std::cerr << std::scientific << std::setprecision(10);
    std::cerr << "\nEntering " << __func__ << " in " << __FILE__ << std::endl;
    std::cerr << "Input coordinates (1) for " << ndim << " monomers:\n";
    for (size_t i = 0; i < ndim; i++) {
        for (size_t j = 0; j < 9; j++) {
            std::cerr << xyz1[9 * i + j] << " , ";
        }
        std::cerr << std::endl;
    }
    std::cerr << "Input coordinates (2) for " << ndim << " monomers:\n";
    for (size_t i = 0; i < ndim; i++) {
        for (size_t j = 0; j < 15; j++) {
            std::cerr << xyz2[15 * i + j] << " , ";
        }
        std::cerr << std::endl;
    }
    std::cerr << "Input gradients (1) for " << ndim << " monomers:\n";
    for (size_t i = 0; i < ndim; i++) {
        for (size_t j = 0; j < 9; j++) {
            std::cerr << grad1[9 * i + j] << " , ";
        }
        std::cerr << std::endl;
    }
    std::cerr << "Input gradients (2) for " << ndim << " monomers:\n";
    for (size_t i = 0; i < ndim; i++) {
        for (size_t j = 0; j < 15; j++) {
            std::cerr << grad2[15 * i + j] << " , ";
        }
        std::cerr << std::endl;
    }
    std::cerr << "Input virial:\n";
    for (size_t i = 0; i < 9; i++) {
        std::cerr << (*virial)[i] << " , ";
    }
    std::cerr << std::endl;
#endif

    std::vector<double> energies(ndim, 0.0);

    for (size_t j = 0; j < ndim; j++) {
        double mon1[9];
        double mon2[15];

        std::copy(xyz1 + j * 9, xyz1 + (j + 1) * 9, mon1);
        std::copy(xyz2 + j * 15, xyz2 + (j + 1) * 15, mon2);

        const double d12[3] = {mon1[0] - mon2[0], mon1[1] - mon2[1], mon1[2] - mon2[2]};

        const double r12sq = d12[0] * d12[0] + d12[1] * d12[1] + d12[2] * d12[2];
        const double r12 = std::sqrt(r12sq);

        if (r12 > m_r2f) continue;

        double xcrd[24];  // coordinates of real sites ONLY

        std::copy(mon1, mon1 + 9, xcrd);
        std::copy(mon2, mon2 + 15, xcrd + 9);

        double v[38];

        double sw = 0.0;
        double gsw = 0.0;

        const double* A_1_a = xcrd + 0;
        const double* B_1_a = xcrd + 3;
        const double* B_2_a = xcrd + 6;

        const double* C_1_b = xcrd + 9;
        const double* D_1_b = xcrd + 12;
        const double* D_2_b = xcrd + 15;
        const double* D_3_b = xcrd + 18;
        const double* D_4_b = xcrd + 21;

        double Z_1_a[3];
        double Z_2_a[3];

        // vsites virt;
        double w12 = -9.721486914088159e-02;  // from MBpol
        double w13 = -9.721486914088159e-02;
        double wcross = 9.859272078406150e-02;

        monomer m;

        m.setup(A_1_a, w12, wcross, Z_1_a, Z_2_a);

        variable vr[38];

        v[0] = vr[0].v_exp0(m_d_intra_AB, m_k_intra_AB, A_1_a, B_1_a);
        v[1] = vr[1].v_exp0(m_d_intra_AB, m_k_intra_AB, A_1_a, B_2_a);
        v[2] = vr[2].v_exp0(m_d_intra_BB, m_k_intra_BB, B_1_a, B_2_a);

        v[3] = vr[3].v_exp0(m_d_intra_CD, m_k_intra_CD, C_1_b, D_1_b);
        v[4] = vr[4].v_exp0(m_d_intra_CD, m_k_intra_CD, C_1_b, D_2_b);
        v[5] = vr[5].v_exp0(m_d_intra_CD, m_k_intra_CD, C_1_b, D_3_b);
        v[6] = vr[6].v_exp0(m_d_intra_CD, m_k_intra_CD, C_1_b, D_4_b);
        v[7] = vr[7].v_exp0(m_d_intra_DD, m_k_intra_DD, D_1_b, D_2_b);
        v[8] = vr[8].v_exp0(m_d_intra_DD, m_k_intra_DD, D_1_b, D_3_b);
        v[9] = vr[9].v_exp0(m_d_intra_DD, m_k_intra_DD, D_1_b, D_4_b);
        v[10] = vr[10].v_exp0(m_d_intra_DD, m_k_intra_DD, D_2_b, D_3_b);
        v[11] = vr[11].v_exp0(m_d_intra_DD, m_k_intra_DD, D_2_b, D_4_b);
        v[12] = vr[12].v_exp0(m_d_intra_DD, m_k_intra_DD, D_3_b, D_4_b);

        v[13] = vr[13].v_exp0(m_d_AC, m_k_AC, A_1_a, C_1_b);
        v[14] = vr[14].v_exp0(m_d_AD, m_k_AD, A_1_a, D_1_b);
        v[15] = vr[15].v_exp0(m_d_AD, m_k_AD, A_1_a, D_2_b);
        v[16] = vr[16].v_exp0(m_d_AD, m_k_AD, A_1_a, D_3_b);
        v[17] = vr[17].v_exp0(m_d_AD, m_k_AD, A_1_a, D_4_b);

        v[18] = vr[18].v_exp0(m_d_BC, m_k_BC, B_1_a, C_1_b);
        v[19] = vr[19].v_exp0(m_d_BD, m_k_BD, B_1_a, D_1_b);
        v[20] = vr[20].v_exp0(m_d_BD, m_k_BD, B_1_a, D_2_b);
        v[21] = vr[21].v_exp0(m_d_BD, m_k_BD, B_1_a, D_3_b);
        v[22] = vr[22].v_exp0(m_d_BD, m_k_BD, B_1_a, D_4_b);

        v[23] = vr[23].v_exp0(m_d_BC, m_k_BC, B_2_a, C_1_b);
        v[24] = vr[24].v_exp0(m_d_BD, m_k_BD, B_2_a, D_1_b);
        v[25] = vr[25].v_exp0(m_d_BD, m_k_BD, B_2_a, D_2_b);
        v[26] = vr[26].v_exp0(m_d_BD, m_k_BD, B_2_a, D_3_b);
        v[27] = vr[27].v_exp0(m_d_BD, m_k_BD, B_2_a, D_4_b);

        v[28] = vr[28].v_coul0(m_d_CZ, m_k_CZ, Z_1_a, C_1_b);
        v[29] = vr[29].v_coul0(m_d_DZ, m_k_DZ, Z_1_a, D_1_b);
        v[30] = vr[30].v_coul0(m_d_DZ, m_k_DZ, Z_1_a, D_2_b);
        v[31] = vr[31].v_coul0(m_d_DZ, m_k_DZ, Z_1_a, D_3_b);
        v[32] = vr[32].v_coul0(m_d_DZ, m_k_DZ, Z_1_a, D_4_b);

        v[33] = vr[33].v_coul0(m_d_CZ, m_k_CZ, Z_2_a, C_1_b);
        v[34] = vr[34].v_coul0(m_d_DZ, m_k_DZ, Z_2_a, D_1_b);
        v[35] = vr[35].v_coul0(m_d_DZ, m_k_DZ, Z_2_a, D_2_b);
        v[36] = vr[36].v_coul0(m_d_DZ, m_k_DZ, Z_2_a, D_3_b);
        v[37] = vr[37].v_coul0(m_d_DZ, m_k_DZ, Z_2_a, D_4_b);

        double g[38];

        sw = f_switch(r12, gsw);

        energies[j] = polynomial::eval(coefficients.data(), v, g);

        double xgrd[30];
        std::fill(xgrd, xgrd + 30, 0.0);

        double* A_1_a_g = xgrd + 0;
        double* B_1_a_g = xgrd + 3;
        double* B_2_a_g = xgrd + 6;

        double* C_1_b_g = xgrd + 9;
        double* D_1_b_g = xgrd + 12;
        double* D_2_b_g = xgrd + 15;
        double* D_3_b_g = xgrd + 18;
        double* D_4_b_g = xgrd + 21;

        double* Z_1_a_g = xgrd + 24;
        double* Z_2_a_g = xgrd + 27;

        vr[0].grads(g[0], A_1_a_g, B_1_a_g, A_1_a, B_1_a);
        vr[1].grads(g[1], A_1_a_g, B_2_a_g, A_1_a, B_2_a);
        vr[2].grads(g[2], B_1_a_g, B_2_a_g, B_1_a, B_2_a);

        vr[3].grads(g[3], C_1_b_g, D_1_b_g, C_1_b, D_1_b);
        vr[4].grads(g[4], C_1_b_g, D_2_b_g, C_1_b, D_2_b);
        vr[5].grads(g[5], C_1_b_g, D_3_b_g, C_1_b, D_3_b);
        vr[6].grads(g[6], C_1_b_g, D_4_b_g, C_1_b, D_4_b);
        vr[7].grads(g[7], D_1_b_g, D_2_b_g, D_1_b, D_2_b);
        vr[8].grads(g[8], D_1_b_g, D_3_b_g, D_1_b, D_3_b);
        vr[9].grads(g[9], D_1_b_g, D_4_b_g, D_1_b, D_4_b);
        vr[10].grads(g[10], D_2_b_g, D_3_b_g, D_2_b, D_3_b);
        vr[11].grads(g[11], D_2_b_g, D_4_b_g, D_2_b, D_4_b);
        vr[12].grads(g[12], D_3_b_g, D_4_b_g, D_3_b, D_4_b);

        vr[13].grads(g[13], A_1_a_g, C_1_b_g, A_1_a, C_1_b);
        vr[14].grads(g[14], A_1_a_g, D_1_b_g, A_1_a, D_1_b);
        vr[15].grads(g[15], A_1_a_g, D_2_b_g, A_1_a, D_2_b);
        vr[16].grads(g[16], A_1_a_g, D_3_b_g, A_1_a, D_3_b);
        vr[17].grads(g[17], A_1_a_g, D_4_b_g, A_1_a, D_4_b);

        vr[18].grads(g[18], B_1_a_g, C_1_b_g, B_1_a, C_1_b);
        vr[19].grads(g[19], B_1_a_g, D_1_b_g, B_1_a, D_1_b);
        vr[20].grads(g[20], B_1_a_g, D_2_b_g, B_1_a, D_2_b);
        vr[21].grads(g[21], B_1_a_g, D_3_b_g, B_1_a, D_3_b);
        vr[22].grads(g[22], B_1_a_g, D_4_b_g, B_1_a, D_4_b);

        vr[23].grads(g[23], B_2_a_g, C_1_b_g, B_2_a, C_1_b);
        vr[24].grads(g[24], B_2_a_g, D_1_b_g, B_2_a, D_1_b);
        vr[25].grads(g[25], B_2_a_g, D_2_b_g, B_2_a, D_2_b);
        vr[26].grads(g[26], B_2_a_g, D_3_b_g, B_2_a, D_3_b);
        vr[27].grads(g[27], B_2_a_g, D_4_b_g, B_2_a, D_4_b);

        vr[28].grads(g[28], Z_1_a_g, C_1_b_g, Z_1_a, C_1_b);
        vr[29].grads(g[29], Z_1_a_g, D_1_b_g, Z_1_a, D_1_b);
        vr[30].grads(g[30], Z_1_a_g, D_2_b_g, Z_1_a, D_2_b);
        vr[31].grads(g[31], Z_1_a_g, D_3_b_g, Z_1_a, D_3_b);
        vr[32].grads(g[32], Z_1_a_g, D_4_b_g, Z_1_a, D_4_b);

        vr[33].grads(g[33], Z_2_a_g, C_1_b_g, Z_2_a, C_1_b);
        vr[34].grads(g[34], Z_2_a_g, D_1_b_g, Z_2_a, D_1_b);
        vr[35].grads(g[35], Z_2_a_g, D_2_b_g, Z_2_a, D_2_b);
        vr[36].grads(g[36], Z_2_a_g, D_3_b_g, Z_2_a, D_3_b);
        vr[37].grads(g[37], Z_2_a_g, D_4_b_g, Z_2_a, D_4_b);

        // ##DEFINE HERE## the redistribution of the gradients

        m.grads(Z_1_a_g, Z_2_a_g, w12, wcross, A_1_a_g);

        for (int i = 0; i < 9; ++i) {
            xgrd[i] *= sw;
        }

        for (int i = 0; i < 15; ++i) {
            xgrd[i + 9] *= sw;
        }

        // gradient of the switch

        gsw *= energies[j] / r12;
        energies[j] *= sw;
        for (int i = 0; i < 3; ++i) {
            const double d = gsw * d12[i];
            xgrd[i] += d;
            xgrd[i + 9] -= d;
        }

        for (int i = 0; i < 9; ++i) {
            grad1[i + j * 9] += xgrd[i];
        }

        for (int i = 0; i < 15; ++i) {
            grad2[i + j * 15] += xgrd[i + 9];
        }

        if (virial != 0) {
            (*virial)[0] += -A_1_a[0] * A_1_a_g[0] - B_1_a[0] * B_1_a_g[0] - B_2_a[0] * B_2_a_g[0] -
                            C_1_b[0] * C_1_b_g[0] - D_1_b[0] * D_1_b_g[0] - D_2_b[0] * D_2_b_g[0] -
                            D_3_b[0] * D_3_b_g[0] - D_4_b[0] * D_4_b_g[0];

            (*virial)[1] += -A_1_a[0] * A_1_a_g[1] - B_1_a[0] * B_1_a_g[1] - B_2_a[0] * B_2_a_g[1] -
                            C_1_b[0] * C_1_b_g[1] - D_1_b[0] * D_1_b_g[1] - D_2_b[0] * D_2_b_g[1] -
                            D_3_b[0] * D_3_b_g[1] - D_4_b[0] * D_4_b_g[1];

            (*virial)[2] += -A_1_a[0] * A_1_a_g[2] - B_1_a[0] * B_1_a_g[2] - B_2_a[0] * B_2_a_g[2] -
                            C_1_b[0] * C_1_b_g[2] - D_1_b[0] * D_1_b_g[2] - D_2_b[0] * D_2_b_g[2] -
                            D_3_b[0] * D_3_b_g[2] - D_4_b[0] * D_4_b_g[2];

            (*virial)[4] += -A_1_a[1] * A_1_a_g[1] - B_1_a[1] * B_1_a_g[1] - B_2_a[1] * B_2_a_g[1] -
                            C_1_b[1] * C_1_b_g[1] - D_1_b[1] * D_1_b_g[1] - D_2_b[1] * D_2_b_g[1] -
                            D_3_b[1] * D_3_b_g[1] - D_4_b[1] * D_4_b_g[1];

            (*virial)[5] += -A_1_a[1] * A_1_a_g[2] - B_1_a[1] * B_1_a_g[2] - B_2_a[1] * B_2_a_g[2] -
                            C_1_b[1] * C_1_b_g[2] - D_1_b[1] * D_1_b_g[2] - D_2_b[1] * D_2_b_g[2] -
                            D_3_b[1] * D_3_b_g[2] - D_4_b[1] * D_4_b_g[2];

            (*virial)[8] += -A_1_a[2] * A_1_a_g[2] - B_1_a[2] * B_1_a_g[2] - B_2_a[2] * B_2_a_g[2] -
                            C_1_b[2] * C_1_b_g[2] - D_1_b[2] * D_1_b_g[2] - D_2_b[2] * D_2_b_g[2] -
                            D_3_b[2] * D_3_b_g[2] - D_4_b[2] * D_4_b_g[2];

            (*virial)[3] = (*virial)[1];
            (*virial)[6] = (*virial)[2];
            (*virial)[7] = (*virial)[5];
        }
    }

    double energy = 0.0;
    for (size_t i = 0; i < ndim; i++) {
        energy += energies[i];
    }

#ifdef DEBUG
    std::cerr << std::scientific << std::setprecision(10);
    std::cerr << "\nExiting " << __func__ << " in " << __FILE__ << std::endl;
    std::cerr << "Output energy: " << energy << std::endl;
    std::cerr << "Output gradients (1) for " << ndim << " monomers:\n";
    for (size_t i = 0; i < ndim; i++) {
        for (size_t j = 0; j < 9; j++) {
            std::cerr << grad1[9 * i + j] << " , ";
        }
        std::cerr << std::endl;
    }
    std::cerr << "Output gradients (2) for " << ndim << " monomers:\n";
    for (size_t i = 0; i < ndim; i++) {
        for (size_t j = 0; j < 15; j++) {
            std::cerr << grad2[15 * i + j] << " , ";
        }
        std::cerr << std::endl;
    }
    std::cerr << "Output virial:\n";
    for (size_t i = 0; i < 9; i++) {
        std::cerr << (*virial)[i] << " , ";
    }
    std::cerr << std::endl;
#endif

    return energy;
}

}  // namespace x2b_A1B2Z2_C1D4_deg3_exp0

////////////////////////////////////////////////////////////////////////////////
